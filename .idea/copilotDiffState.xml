<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/data/database/ProductoDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/data/database/ProductoDao.kt" />
              <option name="originalContent" value="package com.SPA.Perfulandia.data.database&#10;&#10;import androidx.room.*&#10;import com.SPA.Perfulandia.model.Producto&#10;import kotlinx.coroutines.flow.Flow&#10;&#10;@Dao&#10;interface ProductoDao {&#10;&#10;    // INSERT: Inserta un nuevo producto en la tabla &quot;producto&quot;&#10;    // OnConflictStrategy.REPLACE: Si el ID ya existe, lo reemplaza&#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insert(producto: Producto)&#10;&#10;    // DELETE: Elimina un producto existente de la tabla&#10;    @Delete&#10;    suspend fun delete(producto: Producto)&#10;&#10;    // UPDATE: Actualiza un producto existente (debe tener un ID válido)&#10;    @Update&#10;    suspend fun update(producto: Producto)&#10;&#10;    // SELECT * FROM producto: Obtiene todos los productos&#10;    // Retorna un Flow para que la UI se recomponga automáticamente cuando haya cambios&#10;    @Query(&quot;SELECT * FROM producto&quot;)&#10;    fun getAll(): Flow&lt;List&lt;Producto&gt;&gt;&#10;&#10;    // SELECT * FROM producto WHERE id = :id: Obtiene un producto específico por su ID&#10;    // Retorna null si no encuentra coincidencias&#10;    @Query(&quot;SELECT * FROM producto WHERE id = :id&quot;)&#10;    suspend fun getById(id: Int): Producto?&#10;}" />
              <option name="updatedContent" value="package com.SPA.Perfulandia.data.database&#13;&#10;&#13;&#10;import androidx.room.*&#13;&#10;import com.SPA.Perfulandia.model.Producto&#13;&#10;import kotlinx.coroutines.flow.Flow&#13;&#10;&#13;&#10;@Dao&#10;interface ProductoDao {&#10;&#10;    // INSERT: Inserta un nuevo producto en la tabla &quot;producto&quot;&#10;    // OnConflictStrategy.REPLACE: Si el ID ya existe, lo reemplaza (no da error)&#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insert(producto: Producto)&#10;&#10;    // DELETE: Elimina un producto existente de la tabla&#10;    // El producto debe tener un ID que exista&#10;    @Delete&#10;    suspend fun delete(producto: Producto)&#10;&#10;    // UPDATE: Actualiza un producto existente (debe tener un ID válido)&#10;    @Update&#10;    suspend fun update(producto: Producto)&#10;&#10;    // SELECT * FROM producto: Obtiene TODOS los productos&#10;    // Retorna un Flow para que la UI se recomponga automáticamente cuando haya cambios&#10;    // Este es el componente clave de reactividad: cualquier cambio en la BD&#10;    // emitirá automáticamente la nueva lista a través del Flow&#10;    @Query(&quot;SELECT * FROM producto&quot;)&#10;    fun getAll(): Flow&lt;List&lt;Producto&gt;&gt;&#10;&#10;    // SELECT * FROM producto WHERE id = :id: Obtiene un producto específico&#10;    // Retorna null si no encuentra coincidencias&#10;    @Query(&quot;SELECT * FROM producto WHERE id = :id&quot;)&#10;    suspend fun getById(id: Int): Producto?&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/repository/ProductoRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/repository/ProductoRepository.kt" />
              <option name="originalContent" value="package com.SPA.Perfulandia.repository&#10;&#10;import com.SPA.Perfulandia.data.database.ProductoDao&#10;import com.SPA.Perfulandia.model.Producto&#10;import kotlinx.coroutines.flow.Flow&#10;&#10;class ProductoRepository(&#10;    private val dao: ProductoDao&#10;){&#10;    val productos: Flow&lt;List&lt;Producto&gt;&gt; = dao.getAll()&#10;&#10;    suspend fun insertar(producto: Producto) {&#10;        dao.insert(producto)&#10;    }&#10;&#10;    suspend fun eliminar(producto: Producto) {&#10;        dao.delete(producto)&#10;    }&#10;&#10;    suspend fun actualizar(producto: Producto) {&#10;        dao.update(producto)&#10;    }&#10;&#10;    suspend fun obtenerPorId(id: Int): Producto? {&#10;        return dao.getById(id)&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.SPA.Perfulandia.repository&#13;&#10;&#13;&#10;import com.SPA.Perfulandia.data.database.ProductoDao&#13;&#10;import com.SPA.Perfulandia.model.Producto&#13;&#10;import kotlinx.coroutines.flow.Flow&#13;&#10;&#13;&#10;class ProductoRepository(&#10;    private val dao: ProductoDao&#10;){&#10;    // Expone el Stream de productos desde la BD&#10;    // Flow emite automáticamente cuando la BD cambia&#10;    // ViewModel y UI observan este Flow y se actualizan automáticamente&#10;    val productos: Flow&lt;List&lt;Producto&gt;&gt; = dao.getAll()&#10;&#10;    // INSERT: Agrega un nuevo producto a la BD&#10;    // suspend indica que es asincrónico y debe llamarse desde una corrutina&#10;    suspend fun insertar(producto: Producto) {&#10;        dao.insert(producto)&#10;    }&#10;&#10;    // DELETE: Elimina un producto existente&#10;    // El producto debe tener un ID válido que exista en la BD&#10;    suspend fun eliminar(producto: Producto) {&#10;        dao.delete(producto)&#10;    }&#10;&#10;    // UPDATE: Actualiza un producto existente&#10;    // El producto debe tener un ID válido&#10;    suspend fun actualizar(producto: Producto) {&#10;        dao.update(producto)&#10;    }&#10;&#10;    // SELECT by ID: Obtiene un producto específico&#10;    // Retorna null si el ID no existe&#10;    suspend fun obtenerPorId(id: Int): Producto? {&#10;        return dao.getById(id)&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/ui/screens/EditProductScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/ui/screens/EditProductScreen.kt" />
              <option name="originalContent" value="package com.SPA.Perfulandia.ui.screens&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.*&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.runtime.saveable.rememberSaveable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.unit.dp&#10;import androidx.navigation.NavController&#10;import com.SPA.Perfulandia.model.Producto&#10;import com.SPA.Perfulandia.ui.components.BarraInferior&#10;import com.SPA.Perfulandia.ui.components.ImageCapture&#10;import com.SPA.Perfulandia.viewmodel.HomeViewModel&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun EditProductScreen(&#10;    navController: NavController,&#10;    homeViewModel: HomeViewModel,&#10;    productoId: Int? = null&#10;) {&#10;    var productoOriginal by remember { mutableStateOf&lt;Producto?&gt;(null) }&#10;    var nombre by rememberSaveable { mutableStateOf(&quot;&quot;) }&#10;    var precioText by rememberSaveable { mutableStateOf(&quot;&quot;) }&#10;    var descripcion by rememberSaveable { mutableStateOf(&quot;&quot;) }&#10;    var imagenUri by rememberSaveable { mutableStateOf&lt;String?&gt;(null) }&#10;    var showError by rememberSaveable { mutableStateOf(false) }&#10;    var isLoading by remember { mutableStateOf(true) }&#10;    val scope = rememberCoroutineScope()&#10;&#10;    // Cargar el producto cuando se abre la pantalla&#10;    LaunchedEffect(productoId) {&#10;        scope.launch {&#10;            productoId?.let {&#10;                val producto = homeViewModel.obtenerProductoPorId(it)&#10;                producto?.let { p -&gt;&#10;                    productoOriginal = p&#10;                    nombre = p.nombre&#10;                    precioText = p.precio.toString()&#10;                    descripcion = p.descripcion&#10;                    imagenUri = p.imagen&#10;                }&#10;                isLoading = false&#10;            }&#10;        }&#10;    }&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Editar Producto&quot;) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = { navController.popBackStack() }) {&#10;                        Icon(&#10;                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,&#10;                            contentDescription = &quot;Volver&quot;&#10;                        )&#10;                    }&#10;                }&#10;            )&#10;        },&#10;        bottomBar = {&#10;            BarraInferior(&#10;                onAgregarClick = { navController.navigate(&quot;add_product&quot;) },&#10;                onHomeClick = { navController.popBackStack() },&#10;                onSearchClick = { /* La búsqueda está en home */ }&#10;            )&#10;        }&#10;    ) { padding -&gt;&#10;        if (isLoading) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(padding),&#10;                contentAlignment = androidx.compose.ui.Alignment.Center&#10;            ) {&#10;                CircularProgressIndicator()&#10;            }&#10;        } else if (productoOriginal != null) {&#10;            Column(&#10;                modifier = Modifier&#10;                    .padding(padding)&#10;                    .fillMaxSize()&#10;                    .verticalScroll(rememberScrollState()),&#10;                verticalArrangement = Arrangement.Top&#10;            ) {&#10;&#10;                Column(&#10;                    modifier = Modifier&#10;                        .padding(16.dp)&#10;                ) {&#10;                    OutlinedTextField(&#10;                        value = nombre,&#10;                        onValueChange = { nombre = it },&#10;                        label = { Text(&quot;Nombre&quot;) },&#10;                        modifier = Modifier.fillMaxWidth()&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                    OutlinedTextField(&#10;                        value = precioText,&#10;                        onValueChange = {&#10;                            precioText = it&#10;                            showError = false&#10;                        },&#10;                        keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),&#10;                        label = { Text(&quot;Precio&quot;) },&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        isError = showError&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                    OutlinedTextField(&#10;                        value = descripcion,&#10;                        onValueChange = { descripcion = it },&#10;                        label = { Text(&quot;Descripción&quot;) },&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .heightIn(min = 80.dp),&#10;                        maxLines = 4&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                    // Componente de captura de imagen&#10;                    ImageCapture(&#10;                        onImageCaptured = { uri -&gt;&#10;                            imagenUri = uri&#10;                        },&#10;                        modifier = Modifier.fillMaxWidth()&#10;                    )&#10;&#10;                    Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                    Button(&#10;                        onClick = {&#10;                            val precio = precioText.toIntOrNull()&#10;                            if (precio == null || nombre.isBlank()) {&#10;                                showError = true&#10;                            } else {&#10;                                // Actualizar el producto existente&#10;                                val productoActualizado = productoOriginal!!.copy(&#10;                                    nombre = nombre,&#10;                                    precio = precio,&#10;                                    descripcion = descripcion,&#10;                                    imagen = imagenUri&#10;                                )&#10;                                homeViewModel.actualizarProducto(productoActualizado)&#10;                                navController.popBackStack()&#10;                            }&#10;                        },&#10;                        modifier = Modifier.fillMaxWidth()&#10;                    ) {&#10;                        Text(&quot;Guardar Cambios&quot;)&#10;                    }&#10;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;&#10;                    Button(&#10;                        onClick = { navController.popBackStack() },&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        colors = ButtonDefaults.buttonColors(&#10;                            containerColor = MaterialTheme.colorScheme.error,&#10;                            contentColor = MaterialTheme.colorScheme.onError&#10;                        )&#10;                    ) {&#10;                        Text(&quot;Cancelar&quot;)&#10;                    }&#10;                }&#10;            }&#10;        } else {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(padding),&#10;                contentAlignment = androidx.compose.ui.Alignment.Center&#10;            ) {&#10;                Text(&#10;                    text = &quot;Producto no encontrado&quot;,&#10;                    style = MaterialTheme.typography.bodyLarge,&#10;                    color = MaterialTheme.colorScheme.error&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.SPA.Perfulandia.ui.screens&#13;&#10;&#13;&#10;import androidx.compose.foundation.layout.*&#13;&#10;import androidx.compose.foundation.*&#13;&#10;import androidx.compose.foundation.text.KeyboardOptions&#13;&#10;import androidx.compose.material.icons.Icons&#13;&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#13;&#10;import androidx.compose.material3.*&#13;&#10;import androidx.compose.runtime.*&#13;&#10;import androidx.compose.runtime.saveable.rememberSaveable&#13;&#10;import androidx.compose.ui.Modifier&#13;&#10;import androidx.compose.ui.text.input.KeyboardType&#13;&#10;import androidx.compose.ui.unit.dp&#13;&#10;import androidx.navigation.NavController&#13;&#10;import com.SPA.Perfulandia.model.Producto&#13;&#10;import com.SPA.Perfulandia.ui.components.BarraInferior&#13;&#10;import com.SPA.Perfulandia.ui.components.ImageCapture&#13;&#10;import com.SPA.Perfulandia.viewmodel.HomeViewModel&#13;&#10;import kotlinx.coroutines.launch&#13;&#10;&#13;&#10;@OptIn(ExperimentalMaterial3Api::class)&#13;&#10;@Composable&#13;&#10;fun EditProductScreen(&#13;&#10;    navController: NavController,&#13;&#10;    homeViewModel: HomeViewModel,&#13;&#10;    productoId: Int? = null&#13;&#10;) {&#13;&#10;    var productoOriginal by remember { mutableStateOf&lt;Producto?&gt;(null) }&#13;&#10;    var nombre by rememberSaveable { mutableStateOf(&quot;&quot;) }&#13;&#10;    var precioText by rememberSaveable { mutableStateOf(&quot;&quot;) }&#13;&#10;    var descripcion by rememberSaveable { mutableStateOf(&quot;&quot;) }&#13;&#10;    var imagenUri by rememberSaveable { mutableStateOf&lt;String?&gt;(null) }&#13;&#10;    var showError by rememberSaveable { mutableStateOf(false) }&#13;&#10;    var isLoading by remember { mutableStateOf(true) }&#13;&#10;    val scope = rememberCoroutineScope()&#13;&#10;&#13;&#10;    // Cargar el producto cuando se abre la pantalla&#13;&#10;    LaunchedEffect(productoId) {&#13;&#10;        scope.launch {&#13;&#10;            productoId?.let {&#13;&#10;                val producto = homeViewModel.obtenerProductoPorId(it)&#13;&#10;                producto?.let { p -&gt;&#13;&#10;                    productoOriginal = p&#13;&#10;                    nombre = p.nombre&#13;&#10;                    precioText = p.precio.toString()&#13;&#10;                    descripcion = p.descripcion&#13;&#10;                    imagenUri = p.imagen&#13;&#10;                }&#13;&#10;                isLoading = false&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    Scaffold(&#13;&#10;        topBar = {&#13;&#10;            TopAppBar(&#13;&#10;                title = { Text(&quot;Editar Producto&quot;) },&#13;&#10;                navigationIcon = {&#13;&#10;                    IconButton(onClick = { navController.popBackStack() }) {&#13;&#10;                        Icon(&#13;&#10;                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,&#13;&#10;                            contentDescription = &quot;Volver&quot;&#13;&#10;                        )&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            )&#13;&#10;        },&#13;&#10;        bottomBar = {&#13;&#10;            BarraInferior(&#13;&#10;                onAgregarClick = { navController.navigate(&quot;add_product&quot;) },&#13;&#10;                onHomeClick = { navController.popBackStack() },&#13;&#10;                onSearchClick = { /* La búsqueda está en home */ }&#13;&#10;            )&#13;&#10;        }&#13;&#10;    ) { padding -&gt;&#13;&#10;        if (isLoading) {&#13;&#10;            Box(&#13;&#10;                modifier = Modifier&#13;&#10;                    .fillMaxSize()&#13;&#10;                    .padding(padding),&#13;&#10;                contentAlignment = androidx.compose.ui.Alignment.Center&#13;&#10;            ) {&#13;&#10;                CircularProgressIndicator()&#13;&#10;            }&#13;&#10;        } else if (productoOriginal != null) {&#13;&#10;            Column(&#13;&#10;                modifier = Modifier&#13;&#10;                    .padding(padding)&#13;&#10;                    .fillMaxSize()&#13;&#10;                    .verticalScroll(rememberScrollState()),&#13;&#10;                verticalArrangement = Arrangement.Top&#13;&#10;            ) {&#13;&#10;&#13;&#10;                Column(&#13;&#10;                    modifier = Modifier&#13;&#10;                        .padding(16.dp)&#13;&#10;                ) {&#13;&#10;                    OutlinedTextField(&#13;&#10;                        value = nombre,&#13;&#10;                        onValueChange = { nombre = it },&#13;&#10;                        label = { Text(&quot;Nombre&quot;) },&#13;&#10;                        modifier = Modifier.fillMaxWidth()&#13;&#10;                    )&#13;&#10;&#13;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#13;&#10;&#13;&#10;                    OutlinedTextField(&#13;&#10;                        value = precioText,&#13;&#10;                        onValueChange = {&#13;&#10;                            precioText = it&#13;&#10;                            showError = false&#13;&#10;                        },&#13;&#10;                        keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),&#13;&#10;                        label = { Text(&quot;Precio&quot;) },&#13;&#10;                        modifier = Modifier.fillMaxWidth(),&#13;&#10;                        isError = showError&#13;&#10;                    )&#13;&#10;&#13;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#13;&#10;&#13;&#10;                    OutlinedTextField(&#13;&#10;                        value = descripcion,&#13;&#10;                        onValueChange = { descripcion = it },&#13;&#10;                        label = { Text(&quot;Descripción&quot;) },&#13;&#10;                        modifier = Modifier&#13;&#10;                            .fillMaxWidth()&#13;&#10;                            .heightIn(min = 80.dp),&#13;&#10;                        maxLines = 4&#13;&#10;                    )&#13;&#10;&#13;&#10;                    Spacer(modifier = Modifier.height(16.dp))&#13;&#10;&#13;&#10;                    // Componente de captura de imagen&#13;&#10;                    ImageCapture(&#13;&#10;                        onImageCaptured = { uri -&gt;&#13;&#10;                            imagenUri = uri&#13;&#10;                        },&#13;&#10;                        modifier = Modifier.fillMaxWidth()&#13;&#10;                    )&#13;&#10;&#13;&#10;                    Spacer(modifier = Modifier.height(16.dp))&#13;&#10;&#13;&#10;                    Button(&#10;                        onClick = {&#10;                            val precio = precioText.toIntOrNull()&#10;                            &#10;                            // VALIDACIÓN MEJORADA (igual que AddProductScreen):&#10;                            // - nombre.isNotBlank(): No puede estar vacío&#10;                            // - nombre.length &gt;= 3: Mínimo 3 caracteres&#10;                            // - precio != null: Debe ser un número válido&#10;                            // - precio &gt;= 1000: Precio mínimo 1000&#10;                            // - precio &lt;= 999999: Precio máximo 999999&#10;                            if (nombre.isBlank() || nombre.length &lt; 3 || precio == null || precio &lt; 1000 || precio &gt; 999999) {&#10;                                showError = true&#10;                            } else {&#10;                                // Actualizar el producto existente&#10;                                val productoActualizado = productoOriginal!!.copy(&#10;                                    nombre = nombre,&#10;                                    precio = precio,&#10;                                    descripcion = descripcion,&#10;                                    imagen = imagenUri&#10;                                )&#10;                                homeViewModel.actualizarProducto(productoActualizado)&#10;                                navController.popBackStack()&#10;                            }&#10;                        },&#10;                        modifier = Modifier.fillMaxWidth()&#10;                    ) {&#10;                        Text(&quot;Guardar Cambios&quot;)&#10;                    }&#13;&#10;&#13;&#10;                    Spacer(modifier = Modifier.height(8.dp))&#13;&#10;&#13;&#10;                    Button(&#13;&#10;                        onClick = { navController.popBackStack() },&#13;&#10;                        modifier = Modifier.fillMaxWidth(),&#13;&#10;                        colors = ButtonDefaults.buttonColors(&#13;&#10;                            containerColor = MaterialTheme.colorScheme.error,&#13;&#10;                            contentColor = MaterialTheme.colorScheme.onError&#13;&#10;                        )&#13;&#10;                    ) {&#13;&#10;                        Text(&quot;Cancelar&quot;)&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            }&#13;&#10;        } else {&#13;&#10;            Box(&#13;&#10;                modifier = Modifier&#13;&#10;                    .fillMaxSize()&#13;&#10;                    .padding(padding),&#13;&#10;                contentAlignment = androidx.compose.ui.Alignment.Center&#13;&#10;            ) {&#13;&#10;                Text(&#13;&#10;                    text = &quot;Producto no encontrado&quot;,&#13;&#10;                    style = MaterialTheme.typography.bodyLarge,&#13;&#10;                    color = MaterialTheme.colorScheme.error&#13;&#10;                )&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/viewmodel/HomeViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/SPA/Perfulandia/viewmodel/HomeViewModel.kt" />
              <option name="originalContent" value="package com.SPA.Perfulandia.viewmodel&#10;&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.SPA.Perfulandia.model.Producto&#10;import com.SPA.Perfulandia.repository.ProductoRepository&#10;import kotlinx.coroutines.flow.SharingStarted&#10;import kotlinx.coroutines.flow.stateIn&#10;import kotlinx.coroutines.launch&#10;&#10;class HomeViewModel(&#10;    private val repository: ProductoRepository&#10;) : ViewModel() {&#10;&#10;    // StateFlow que emite la lista de productos desde el repositorio&#10;    // Se convierte a State para que la UI se recomponga automáticamente cuando cambia&#10;    // WhileSubscribed(5000) mantiene la suscripción activa por 5 segundos tras el último observador&#10;    val productos = repository.productos.stateIn(&#10;        scope = viewModelScope,&#10;        started = SharingStarted.WhileSubscribed(5000),&#10;        emptyList()&#10;    )&#10;&#10;    // Inserta un nuevo producto en la base de datos&#10;    // Usa viewModelScope para ejecutar la corrutina de forma asincrónica sin bloquear la UI&#10;    fun agregarProducto(nombre: String, precio: Int, descripcion: String, imagen: String? = null) {&#10;        viewModelScope.launch {&#10;            repository.insertar(&#10;                Producto(&#10;                    nombre = nombre,&#10;                    precio = precio,&#10;                    descripcion = descripcion,&#10;                    imagen = imagen&#10;                )&#10;            )&#10;        }&#10;    }&#10;&#10;    // Elimina un producto de la base de datos&#10;    fun eliminarProducto(producto: Producto) {&#10;        viewModelScope.launch {&#10;            repository.eliminar(producto)&#10;        }&#10;    }&#10;&#10;    // Actualiza un producto existente en la base de datos&#10;    fun actualizarProducto(producto: Producto) {&#10;        viewModelScope.launch {&#10;            repository.actualizar(producto)&#10;        }&#10;    }&#10;&#10;    // Obtiene un producto por su ID de forma asincrónica (suspend function)&#10;    suspend fun obtenerProductoPorId(id: Int): Producto? {&#10;        return repository.obtenerPorId(id)&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.SPA.Perfulandia.viewmodel&#13;&#10;&#13;&#10;import androidx.lifecycle.ViewModel&#13;&#10;import androidx.lifecycle.viewModelScope&#13;&#10;import com.SPA.Perfulandia.model.Producto&#13;&#10;import com.SPA.Perfulandia.repository.ProductoRepository&#13;&#10;import kotlinx.coroutines.flow.SharingStarted&#13;&#10;import kotlinx.coroutines.flow.stateIn&#13;&#10;import kotlinx.coroutines.launch&#13;&#10;&#13;&#10;class HomeViewModel(&#10;    private val repository: ProductoRepository&#10;) : ViewModel() {&#10;&#10;    // StateFlow que emite la lista de productos desde el repositorio&#10;    // - Se convierte a State para que la UI se recomponga automáticamente cuando cambia&#10;    // - WhileSubscribed(5000) mantiene la suscripción activa por 5 segundos tras el último observador&#10;    // - Optimiza recursos: si no hay observadores, desuscribe automáticamente después de 5 segundos&#10;    val productos = repository.productos.stateIn(&#10;        scope = viewModelScope,&#10;        started = SharingStarted.WhileSubscribed(5000),&#10;        emptyList()&#10;    )&#10;&#10;    // Inserta un nuevo producto en la base de datos&#10;    // - Usa viewModelScope para ejecutar la corrutina de forma asincrónica sin bloquear la UI&#10;    // - launch es un builder que no retorna nada (fire-and-forget)&#10;    fun agregarProducto(nombre: String, precio: Int, descripcion: String, imagen: String? = null) {&#10;        viewModelScope.launch {&#10;            repository.insertar(&#10;                Producto(&#10;                    nombre = nombre,&#10;                    precio = precio,&#10;                    descripcion = descripcion,&#10;                    imagen = imagen&#10;                )&#10;            )&#10;        }&#10;    }&#10;&#10;    // Elimina un producto de la base de datos&#10;    // - Se ejecuta en background sin bloquear la UI&#10;    fun eliminarProducto(producto: Producto) {&#10;        viewModelScope.launch {&#10;            repository.eliminar(producto)&#10;        }&#10;    }&#10;&#10;    // Actualiza un producto existente en la base de datos&#10;    // - Solo actualiza si el producto tiene un ID válido (existe en BD)&#10;    fun actualizarProducto(producto: Producto) {&#10;        viewModelScope.launch {&#10;            repository.actualizar(producto)&#10;        }&#10;    }&#10;&#10;    // Obtiene un producto específico por su ID&#10;    // - Es una suspend function: debe llamarse desde una corrutina&#10;    // - Retorna null si no existe un producto con ese ID&#10;    suspend fun obtenerProductoPorId(id: Int): Producto? {&#10;        return repository.obtenerPorId(id)&#10;    }&#10;}&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>